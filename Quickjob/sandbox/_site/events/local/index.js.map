{"version":3,"file":"index.js","sources":["../../../common/js/internal/event/_splitEventStr.js","../../../common/js/internal/event/_reactToEvent.js","../../../common/js/listen.js","../../../common/js/timeSince.js","../../../common/js/parents.js","../../../common/js/selfAndParents.js","../../../common/js/trigger.js","index.js"],"sourcesContent":["const _splitEventStr = eventStr => eventStr.split(\" \");\n\nexport default _splitEventStr;\n","import _splitEventStr from \"./_splitEventStr\";\n\nconst _reactToEvent = (methodName, eventStr, domNodes, callback, isCapture) => {\n\tlet eventTypes = _splitEventStr(eventStr),\n\t\tdomNodeArr = (domNodes.length == null) ? [domNodes] : Array.from(domNodes);\n\n\teventTypes.forEach(eventType => domNodeArr.forEach(domNode => domNode[methodName](eventType, callback, isCapture)));\n};\n\nexport default _reactToEvent;\n","import _reactToEvent from \"./internal/event/_reactToEvent\";\n\nconst listen = (eventStr, domNodes, callback, isCapture = false) => _reactToEvent(\"addEventListener\", eventStr, domNodes, callback, isCapture);\n\nexport default listen;\n","const timeSince = (timestamp) => (timestamp != null) ? ((+new Date()) - timestamp) : undefined;\n\nexport default timeSince;\n","function parents(domNode, memo = []) {\n\tlet parentNode = domNode.parentNode;\n\treturn (!parentNode) ? memo : parents(parentNode, memo.concat([parentNode]));\n}\n\nexport default parents;\n","import parents from \"./parents\";\n\nconst selfAndParents = domNode => (domNode != null) ? [domNode].concat(parents(domNode)) : [];\n\nexport default selfAndParents;\n","function trigger(eventName, bubbles, target) {\n\tlet event;\n\n\tif (window.CustomEvent != null) {\n\t\tevent = document.createEvent('Event');\n\t\tevent.initEvent(eventName, bubbles, true);\n\t}\n\telse {\n\t\tevent = new CustomEvent(eventName, {\n\t\t\tbubbles\n\t\t});\n\t}\n\n\ttarget.dispatchEvent(event);\n}\n\nexport default trigger;\n","import listen from \"../../../common/js/listen\";\nimport ignore from \"../../../common/js/ignore\";\nimport timeSince from \"../../../common/js/timeSince\";\nimport selfAndParents from \"../../../common/js/selfAndParents\";\nimport trigger from \"../../../common/js/trigger\";\n\nclass EventNormalizer {\n\tstatic _updateConfigured(eventName) {\n\t\tEventNormalizer.memo.add(eventName);\n\t}\n\n\tstatic _isConfigured(eventName) {\n\t\treturn EventNormalizer.memo.has(eventName);\n\t}\n\n\tstatic _doConfig(eventName, condition) {\n\t\treturn function(event) {\n\t\t\tif (condition(event)) {\n\t\t\t\tconsole.log(event);\n\t\t\t\ttrigger(eventName, true, event.target);\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic config(eventName, eventStr, condition) {\n\t\tif (!this._isConfigured(eventName)) {\n\t\t\tlisten(eventStr, document, this._doConfig(eventName, condition));\n\t\t}\n\t}\n}\n\nEventNormalizer.memo = new Set();\nEventNormalizer.draggedElements = new WeakSet();\nEventNormalizer.lastTouch = undefined;\n\n\n\n\n\nlet testNodes = document.getElementsByClassName(\"group--a\");\nconsole.log(testNodes);\n\nlisten(\"point tap enter leave ghostclick\", testNodes, event => {\n\tconsole.log(event.type, event.target);\n});\n\nlisten(\"pointoutside tapoutside\", testNodes, event => {\n\tconsole.log(event.type, event.target);\n});\n\n\n\n\n\nfunction _trackLastTouch(event) {\n\tif (event.type === \"touchend\") {\n\t\tEventNormalizer.lastTouch = +new Date();\n\t}\n}\n\nfunction _trackDragging(event) {\n\tif (event.type === \"touchmove\") {\n\t\tEventNormalizer.draggedElements.add(event.target);\n\t}\n}\n\nfunction _hasDragHappened() {\n\treturn EventNormalizer.draggedElements.has(event.target);\n}\n\nfunction _ignoreDragging(event) {\n\tif (event.type === \"touchend\") {\n\t\tEventNormalizer.draggedElements.delete(event.target);\n\t}\n}\n\nfunction _isMouse() {\n\treturn EventNormalizer.lastTouch == null || timeSince(EventNormalizer.lastTouch) > 500;\n}\n\nfunction _hasTargetChanged(event) {\n\tlet targetParents = selfAndParents(event.target),\n\t\trelatedParents = selfAndParents(event.relatedTarget),\n\t\tchangedNodes = targetParents.filter(domNode => !relatedParents.includes(domNode));\n\n\treturn changedNodes.length > 0;\n}\n\n\n\n\n\nEventNormalizer.config(\"point\", \"touchend click\", event => {\n\t_trackLastTouch(event);\n\treturn event.type === \"click\" && _isMouse();\n});\n\nEventNormalizer.config(\"tap\", \"touchmove touchend\", event => {\n\t_trackDragging(event);\n\n\tif (event.type === \"touchend\" && !_hasDragHappened()) {\n\t\t_ignoreDragging(event);\n\t\treturn true;\n\t}\n\telse {\n\t\t_ignoreDragging(event);\n\t}\n});\n\nEventNormalizer.config(\"enter\", \"touchend mouseover\", event => {\n\t_trackLastTouch(event);\n\treturn event.type === \"mouseover\" && _isMouse() && _hasTargetChanged(event);\n});\n\nEventNormalizer.config(\"leave\", \"touchend mouseout\", event => {\n\t_trackLastTouch(event);\n\treturn event.type === \"mouseout\" && _isMouse() && _hasTargetChanged(event);\n});\n\nEventNormalizer.config(\"ghostclick\", \"touchend click\", event => {\n\t_trackLastTouch(event);\n\treturn event.type === \"click\" && !_isMouse();\n});\n\nEventNormalizer.config(\"pointoutside\", \"point\", event => {\n\treturn false;\n});\n\nEventNormalizer.config(\"tapoutside\", \"tap\", event => {\n\treturn false;\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// done;\n"],"names":["_splitEventStr","eventStr","split","_reactToEvent","methodName","domNodes","callback","isCapture","eventTypes","domNodeArr","length","Array","from","forEach","domNode","eventType","listen","timeSince","timestamp","Date","undefined","parents","memo","parentNode","concat","selfAndParents","trigger","eventName","bubbles","target","event","window","CustomEvent","document","createEvent","initEvent","dispatchEvent","EventNormalizer","add","has","condition","log","_isConfigured","_doConfig","Set","draggedElements","WeakSet","lastTouch","testNodes","getElementsByClassName","console","type","_trackLastTouch","_trackDragging","_hasDragHappened","_ignoreDragging","delete","_isMouse","_hasTargetChanged","targetParents","relatedParents","relatedTarget","changedNodes","filter","includes","config"],"mappings":"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"}